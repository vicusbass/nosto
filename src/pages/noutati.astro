---
import type { SanityDocument } from '@sanity/client';
import { sanityClient } from 'sanity:client';
import { Image } from 'astro:assets';
import { PortableText } from 'astro-portabletext';
import Layout from '../layouts/Layout.astro';
import SectionTitle from '../components/SectionTitle.astro';
import urlForImage from '../utils/sanityImageUrl';

const POSTS_QUERY = `*[
  _type == "newsPost"
  && defined(slug.current)
]|order(date desc)[0...12]{_id, title, slug, date, text, image}`;

const posts = await sanityClient.fetch<SanityDocument[]>(POSTS_QUERY);
---

<Layout title="Noutati - Nosto">
  <section id="hero" class="px-10 py-8">
    <div class="w-full h-[400px] relative overflow-hidden bg-gray-200 rounded-tr-[6rem]">
      <!-- Placeholder hero image -->
      <Image
        src="https://placehold.co/1600x400/orange/white?text=Noutati+Hero+Image"
        alt="News hero"
        class="w-full h-full object-cover"
        inferSize={true}
      />
      <!-- Optional overlay with text -->
      <div class="absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-30">
        <h2 class="font-medium text-center">Stadiu È˜antier</h2>
      </div>
    </div>
  </section>

  <SectionTitle title="Timeline" id="timeline-title" />

  <section id="articles" class="px-10">
    <!-- News Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {
        posts.map((post: SanityDocument) => {
          const imageUrl = post?.image ? urlForImage(post.image)?.url() : null;
          return (
            <article class="bg-white overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300">
              <a href={`/noutati/${post.slug.current}`} class="block">
                {imageUrl && (
                  <div class="aspect-video overflow-hidden">
                    <Image
                      src={imageUrl}
                      alt={post.title}
                      class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                      inferSize={true}
                    />
                  </div>
                )}
                <div class="p-6">
                  <h2 class="text-xl font-semibold mb-3 text-gray-900 hover:text-orange-500 transition-colors duration-200 line-clamp-2">
                    {post.title}
                  </h2>
                  <p class="text-sm text-gray-500 mb-3 font-medium">
                    {new Date(post.date).toLocaleDateString('ro-RO')}
                  </p>
                  <div class="text-gray-600 text-sm leading-relaxed prose prose-sm max-w-none">
                    <PortableText value={post.text} />
                  </div>
                </div>
              </a>
            </article>
          );
        })
      }
    </div>
  </section>
</Layout>
